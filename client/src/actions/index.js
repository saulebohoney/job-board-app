import * as Cookies from 'js-cookie';

export const REQUEST_GET_USER='REQUEST_GET_USER';
export const requestGetUser=()=>({
    type: REQUEST_GET_USER
});
//Retrieve the user once OAuth is successful
export const ALLOW_GET_USER='ALLOW_GET_USER';
export const allowGetUser=(currentUser)=>({
    type: ALLOW_GET_USER,
    currentUser
});

export const REJECT_GET_USER='REJECT_GET_USER';
export const rejectGetUser=(error)=>({
    type: REJECT_GET_USER,
    error
});
export const GET_USER='GET_USER';
export const getUser=(accessToken)=>dispatch=>{
    dispatch(requestGetUser());
    return fetch('/api/questions', {
        headers: {
            'Authorization': `Bearer ${accessToken}`
        }
    }).then(res => {
        if (!res.ok) {
            if (res.status === 401) {
                Cookies.remove('accessToken');
                return;
            }
            throw new Error(res.statusText);
        }
        return res.json();
    }).then(currentUser=>{
        return dispatch(allowGetUser(currentUser));
    })
        .catch(error=>{
            dispatch(rejectGetUser(error));
        });
};
